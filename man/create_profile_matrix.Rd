% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/create_profile_matrix.R
\name{create_profile_matrix}
\alias{create_profile_matrix}
\title{Create a Cell-Type Profile Matrix from Single-Cell Expression Data}
\usage{
create_profile_matrix(
  mtx,
  cellAnnots,
  cellTypeCol,
  cellNameCol,
  matrixName = "Custom",
  outDir = "./",
  geneList = NULL,
  normalize = FALSE,
  scalingFactor = 5,
  minCellNum = 15,
  minGenes = 100,
  discardCellTypes = FALSE
)
}
\arguments{
\item{mtx}{A gene-by-cell matrix of raw counts (dense or sparse).}

\item{cellAnnots}{A data frame containing cell annotations.}

\item{cellTypeCol}{Name of the column in \code{cellAnnots} containing
cell-type labels.}

\item{cellNameCol}{Name of the column in \code{cellAnnots} containing
cell barcodes / IDs.}

\item{matrixName}{Base name for output file (default: "Custom").}

\item{outDir}{Directory for writing output (default: current directory).
If \code{NULL}, no file is written.}

\item{geneList}{Optional character vector of genes to retain.}

\item{normalize}{Logical; if TRUE, performs median normalisation.}

\item{scalingFactor}{Numeric scale multiplier applied to final matrix.}

\item{minCellNum}{Minimum number of viable cells per cell type.}

\item{minGenes}{Minimum genes expressed per cell (non-zero counts).}

\item{discardCellTypes}{Logical; if TRUE, removes unknown / doublet /
filtered cell types.}
}
\value{
A numeric gene-by-celltype matrix of averaged expression.
}
\description{
This function generates a "reference profile matrix" (mean expression per
cell type) from single-cell count data, analogous to reference matrices used
for deconvolution methods. It supports filtering low-quality cells,
normalisation, optional gene list restriction, and saving the resulting
matrix to file.
}
\details{
The function:
\enumerate{
\item Validates input, ensuring cell IDs match matrix column names.
\item Optionally removes ambiguous cell types.
\item Optionally normalises counts by median library size.
\item For each cell type:
\item Filters low-quality cells.
\item Computes mean expression (if enough cells pass filters).
\item Filters genes expressed in at least one cell type.
\item Applies scaling and optional gene restriction.
\item Writes a CSV file if \code{outDir} is provided.
}
}
