% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/algorithm2.R
\name{algorithm2}
\alias{algorithm2}
\title{Core Deconvolution Algorithm (BulkDecon Internal)}
\usage{
algorithm2(
  Y,
  X,
  bg = 0,
  weights = NULL,
  resid_thresh = 3,
  lower_thresh = 0.5,
  align_genes = TRUE,
  maxit = 1000
)
}
\arguments{
\item{Y}{Matrix of observed bulk expression data (genes × samples).}

\item{X}{Cell reference expression matrix (genes × cell types).}

\item{bg}{Background matrix or vector (same gene dimension as \code{Y}).}

\item{weights}{Optional gene × sample weights matrix.}

\item{resid_thresh}{Threshold for outlier detection on log-residuals.}

\item{lower_thresh}{Threshold used in log2 stabilisation for residuals.}

\item{align_genes}{Logical; if \code{TRUE}, align gene sets between \code{Y} and \code{X}.}

\item{maxit}{Maximum iterations passed to \code{deconLNR()}.}
}
\value{
A list containing:
\itemize{
\item \code{beta} – estimated cell-type abundances
\item \code{sigmas} – covariance matrices of model coefficients
\item \code{yhat} – fitted values
\item \code{resids} – residual matrix
\item \code{p}, \code{t}, \code{se} – p-values, t-statistics, SEs
\item any additional fields returned by \code{deconLNR()}
}
}
\description{
Performs the two–stage log-normal regression (LNR) deconvolution used
internally in BulkDecon.
This function aligns genes (optional), fits the LNR model, removes outlier
genes based on residuals, refits the model, and computes statistical
significance (t-statistics and p-values).
}
\details{
The algorithm proceeds in 7 steps:
\enumerate{
\item Optional alignment of genes between \code{Y} and \code{X}.
\item Internal formatting of matrices via \code{tidy_X_and_Y()}.
\item Determination of the epsilon parameter (smallest nonzero value).
\item Initial LNR fit using \code{deconLNR()}.
\item Detection of outlier genes via \code{flagOutliers()}.
\item Refit after masking outlier genes with \code{NA}.
\item Compute standard errors, t-statistics and p-values.
}
}
\keyword{internal}
